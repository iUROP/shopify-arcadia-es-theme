<div class="i-header-menu">
  <div id="header-hamburger" class="i-header-menu__toggler">
    {% render 'icon-hamburger' %}
  </div>

  <div class="i-header-menu__overlay"></div>

  <nav class="i-header-menu__content">
    <div id="header-close" class="i-header-menu__close">
      {% render 'icon-close' %}
    </div>

    {%- comment -%} SECONDARY LINKS {%- endcomment -%}
    <ul class="i-header-menu__content--items" role="list">
      {%- for link in section.settings.menu.links -%}
        {%- unless link.title == 'Productos' or link.url contains '/collections' -%}
          <li class="i-header-menu__content--items__item">
            <a href="{{ link.url }}" class="i-header-menu__content--items__item--link">
              {{ link.title }}
            </a>
          </li>
        {%- endunless -%}
      {%- endfor -%}
    </ul>

    {%- comment -%} PRODUCTOS SECTION (COLLAPSIBLE EN MOBILE) {%- endcomment -%}
    <details class="i-header-menu__products-accordion">
      <summary>
        <span>Productos</span>
      </summary>

      <div class="i-header-menu__products">
        {%- assign menu_products = "miel-cruda-multifloral,miel-cruda-de-bosque,miel-cruda-de-lavanda,miel-cruda-de-romero,miel-cruda-de-azahar,miel-cruda-de-tomillo" | split: "," -%}

        {%- for handle in menu_products -%}
          {%- assign product = all_products[handle] -%}
          {%- if product -%}
            <a href="{{ product.url }}" class="i-header-menu__product-card">
              <div class="i-header-menu__product-card-image">
                <img
                  src="{{ product.featured_image | img_url: '160x160' }}"
                  alt="{{ product.title }}"
                  width="80"
                  height="80"
                  loading="lazy"
                />
              </div>
              <div class="i-header-menu__product-card-info">
                <span class="i-header-menu__product-card-title">{{ product.title }}</span>
                <span class="i-header-menu__product-card-price">{{ product.price | money }}</span>
              </div>
            </a>
          {%- endif -%}
        {%- endfor -%}

        <a href="/products/pack-premium" class="i-header-menu__cta-button">
          Comprar miel
        </a>
      </div>
    </details>
  </nav>
</div>

<script>
  (function() {
    const hamburger = document.getElementById('header-hamburger');
    const closeBtn = document.getElementById('header-close');
    const menuContent = document.querySelector('.i-header-menu__content');
    const overlay = document.querySelector('.i-header-menu__overlay');
    const header = document.querySelector('.section-header');
    const body = document.body;

    function openMenu() {
      menuContent.classList.add('is-open');
      overlay.classList.add('is-open');
      header.classList.add('menu-open');
      body.style.overflow = 'hidden';
    }

    function closeMenu() {
      menuContent.classList.remove('is-open');
      overlay.classList.remove('is-open');
      header.classList.remove('menu-open');
      body.style.overflow = '';
      menuContent.querySelectorAll('details[open]').forEach((el) => el.removeAttribute('open'));
    }

    if (hamburger) hamburger.addEventListener('click', openMenu);
    if (closeBtn) closeBtn.addEventListener('click', closeMenu);
    if (overlay) overlay.addEventListener('click', closeMenu);
  })();
</script>
