<div class="i-announcement-bar Bg-Colors-100">
  {% for block in section.blocks %}
    <div class="i-announcement-bar__item Text-Colors-200 Typo-Body-S Family-Font---Body">
      {% if block.settings.show_subscribe %}
        <a href="/products/miel-cruda-de-azahar">
      {% endif %}

      {{ block.settings.text }}

      {% if block.settings.show_subscribe %}
        </a>
      {% endif %}
    </div>
  {% endfor %}
</div>

{% schema %}
{
  "name": "iUROP Announcement Bar",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "range",
      "id": "rotation_interval",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Intervalo de rotaci贸n (segundos)",
      "default": 3
    }
  ],
  "blocks": [
    {
      "type": "content_block",
      "name": "Item",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Texto"
        },
        {
          "type": "checkbox",
          "id": "show_subscribe",
          "default": true,
          "label": "Mostrar CTA de suscripci贸n"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "iUROP Announcement Bar"
    }
  ]
}
{% endschema %}

<script>
(function() {
  function initAnnouncementRotation() {
    const announcementBar = document.querySelector('.i-announcement-bar');

    const items = announcementBar.querySelectorAll('.i-announcement-bar__item');
    const rotationInterval = {{ section.settings.rotation_interval | default: 3 }} * 1000;
    
    if (items.length <= 1) {
      console.log('Solo 1 item (El otro cta esta desactivado');
      return;
    }
    
    let currentIndex = 0;
    
      function showItem(index) {
        items.forEach((item, i) => {
          if (i === index) {
            item.style.opacity = '1';
            item.style.visibility = 'visible';
            item.style.position = 'relative';
            item.style.zIndex = '2';
          } else {
            item.style.opacity = '0';
            item.style.visibility = 'hidden';
            item.style.position = 'absolute';
            item.style.zIndex = '1';
          }
        });
      }
    
    // Funci贸n para rotar
    function rotateItems() {
      
      // Avanzar al siguiente elemento
      currentIndex = (currentIndex + 1) % items.length;
      
      setTimeout(() => {
        showItem(currentIndex);
      }, 50);
    }
    
    // Mostrar el primer elemento inicialmente
    showItem(0);
    
    // Iniciar rotaci贸n
    setInterval(rotateItems, rotationInterval);
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAnnouncementRotation);
  } else {
    initAnnouncementRotation();
  }
})();
</script>
